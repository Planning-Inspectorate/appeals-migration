generator client {
  provider = "prisma-client"
  output   = "./client"

  engineType = "client"
  runtime    = "nodejs"
}

datasource db {
  provider = "sqlserver"
}

// NOTES
//
// use '//' comments for notes relevant to the schema
// use '///' comments for notes that should be included in the types definition
// see https://www.prisma.io/docs/concepts/components/prisma-schema#comments

/// A table to hold migration parameter configuration
/// each entry would equate to one case search, and will map to CaseSearchCriteria in case-search.ts
model ToMigrateParameter {
  id Int @id

  caseTypeName     String?
  dateReceivedFrom DateTime?
  dateReceivedTo   DateTime?
  decisionDateFrom DateTime?
  decisionDateTo   DateTime?
  lpa              String?
  procedureType    String?
  startDateFrom    DateTime?
  startDateTo      DateTime?
  status           String?
}

model CaseToMigrate {
  caseReference String @id

  // migration steps tracked per case
  // InProgress fields used to lock the case for that processing step

  dataStepId Int           @unique
  DataStep   MigrationStep @relation("DataStep", fields: [dataStepId], references: [id], onUpdate: NoAction, onDelete: NoAction)

  documentsStepId Int           @unique
  DocumentsStep   MigrationStep @relation("DocumentsStep", fields: [documentsStepId], references: [id], onUpdate: NoAction, onDelete: NoAction)

  validationStepId Int           @unique
  ValidationStep   MigrationStep @relation("ValidationStep", fields: [validationStepId], references: [id], onUpdate: NoAction, onDelete: NoAction)

  // validation outcome
  dataValidated      Boolean?
  documentsValidated Boolean?
}

model MigrationStep {
  id Int @id @default(autoincrement())

  /// whether this step is locked for processing
  inProgress Boolean @default(false)
  complete   Boolean @default(false)

  // todo: attempts and/or failures?

  DataStepCase       CaseToMigrate? @relation("DataStep")
  DocumentsStepCase  CaseToMigrate? @relation("DocumentsStep")
  ValidationStepCase CaseToMigrate? @relation("ValidationStep")
}
